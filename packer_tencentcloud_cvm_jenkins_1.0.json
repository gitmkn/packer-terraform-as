{
  "variables": {
    "secret_id": "{{env `TENCENTCLOUD_SECRET_ID`}}",
    "secret_key": "{{env `TENCENTCLOUD_SECRET_KEY`}}"
  },
  "builders": [
    {
      "type": "tencentcloud-cvm",
      "secret_id": "{{user `secret_id`}}",
      "secret_key": "{{user `secret_key`}}",
      "region": "ap-guangzhou",
      "zone": "ap-guangzhou-6",
      "instance_type": "SA2.SMALL1",
      "source_image_id": "img-9xqekomx",
      "ssh_username": "root",
      "image_name": "PackerTest-terraform-as-1",
      "disk_type": "CLOUD_PREMIUM",
      "packer_debug": true,
      "associate_public_ip_address": true,
      "run_tags": {
        "good": "luck"
      }
    }
  ],
  "post-processors": [
    {
      "type": "shell-local",
      "inline": [
        "echo 'IMAGE_ID={{.ImageId}}' > ./env.txt"
      ]
    }
  ],
  "provisioners": [{
    "type": "shell",
    "inline": [
      "cd /root/",
      "yes | sudo dnf install java-11-openjdk-devel",
      "sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo",
      "sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key",
      "sudo sed -i 's/gpgcheck=1/gpgcheck=0/g' /etc/yum.repos.d/jenkins.repo",
      "yes | sudo dnf install jenkins",
      "sudo systemctl start jenkins",
      "sudo systemctl enable jenkins"
    ]
  }]
}
